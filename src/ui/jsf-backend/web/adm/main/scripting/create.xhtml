<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:adm="http://www.flexive.com/jsf/admin"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:fx="http://www.flexive.com/jsf/core">

<body>

<ui:composition template="/adm/contentTemplate.xhtml">
    <ui:define name="body">
        <h:form id="frm">
            <a4j:region>
                <t:saveState value="#{scriptBean.inputFieldEnabled}"/>
                <t:saveState value="#{scriptBean.verifyButtonEnabled}"/>
                <t:saveState value="#{scriptBean.executeButtonEnabled}"/>
                <t:saveState value="#{scriptBean.sinfo.event}"/>
                <t:saveState value="#{scriptBean.sinfo.description}"/>
                <t:saveState value="#{scriptBean.sinfo.code}"/>

                <adm:tab label="#{fxMessageBean['Script.tabtitle.create']}" active="true" id="tab1"/>
                <fx:formRow labelKey="Script.field.name" id="name" newLine="false" relativeWidth="100">
                    <h:inputText id="name" value="#{scriptBean.sinfo.name}" size="30">
                        <a4j:support event="onkeyup" reRender="scriptnameerror,all, verifyPanel, executePanel, importPanel"
                                     eventsQueue="main" requestDelay="500" action="#{scriptBean.verifyScriptName}"
                                     oncomplete="ajaxButtonRequest();"/>
                    </h:inputText>
                    <h:outputText id="scriptnameerror" value="#{scriptBean.nameErrorMsg}"
                                  style="color:red; padding-left:4px"/>
                </fx:formRow>

                <a4j:outputPanel id="all" layout="block">
                    <fx:formRow labelKey="Script.field.event.default" id="event">
                        <h:selectOneListbox id="event" size="1" value="#{scriptBean.sinfo.event}"
                                            disabled="#{!scriptBean.inputFieldEnabled}">
                            <f:selectItems value="#{fxSelectBean.allScriptEventsAsEnum}"/>
                            <a4j:support event="onchange" reRender="executePanel"
                                         action="#{scriptBean.checkScriptEvent}"
                                         eventsQueue="main" requestDelay="500" oncomplete="ajaxButtonRequest();"/>
                        </h:selectOneListbox>
                    </fx:formRow>

                    <fx:formRow labelKey="Script.field.desc" id="desc">
                        <h:inputText id="desc" value="#{scriptBean.sinfo.description}" size="50"
                                     disabled="#{!scriptBean.inputFieldEnabled}"/>
                    </fx:formRow>

                    <fx:formRow labelKey="Script.field.code" id="code">
                        <h:inputTextarea id="code" value="#{scriptBean.sinfo.code}" cols="100" rows="25"
                                         disabled="#{!scriptBean.inputFieldEnabled}"/>
                    </fx:formRow>
                </a4j:outputPanel>

                <adm:commandButton id="saveButton" labelKey="Script.button.create"
                                   icon="save" bean="#{scriptBean}" action="createScript"/>

                <adm:commandButton id="cancelButton" labelKey="Script.button.cancel"
                                   icon="cancel" action="scriptOverview"/>

                <a4j:outputPanel id="importPanel" layout="block">
                    <adm:commandButton id="defaultImports" labelKey="Script.button.defaultImports"
                                       icon="compact" bean="#{scriptBean}" action="addDefaultImports"
                                       buttonDisabled="#{!scriptBean.inputFieldEnabled}" ajax="true" toolbarPosition="2"/>
                </a4j:outputPanel>

                <a4j:outputPanel id="executePanel" layout="block">
                    <adm:commandButton id="executeButton" labelKey="Script.button.run" icon="run"
                                       lockscreen="false" bean="#{scriptBean}"
                                       buttonDisabled="#{!scriptBean.executeButtonEnabled}"
                                       action="runScriptInConsole" ajax="true" toolbarPosition="3"/>
                </a4j:outputPanel>

                <a4j:outputPanel id="verifyPanel" layout="block">
                    <adm:commandButton id="verifyButton" labelKey="Script.button.verify" bean="#{scriptBean}"
                                       action="checkScriptSyntax" icon="check" toolbarPosition="4"
                                       rendered="#{scriptBean.verifyButtonEnabled}" ajax="true" separator="after"/>
                </a4j:outputPanel>

                <br/><br/>

                <a4j:outputPanel id="resultPanel" rendered="#{scriptBean.result != null}">
                    <pre>#{scriptBean.result}</pre>
                    <span style="color:gray;font-style:italic;">
                        #{fxMessageBean['ScriptConsole.label.executionTime, #{scriptBean.executionTime}']}
                    </span>
                </a4j:outputPanel>

                <adm:toolbarPluginButtons/>
            </a4j:region>
        </h:form>
    </ui:define>
</ui:composition>
</body>
</html>