<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:adm="http://www.flexive.com/jsf/admin"
      xmlns:fx="http://www.flexive.com/jsf/core">

<ui:composition template="/adm/main/importexport/structureExportTemplate.xhtml">

    <ui:define name="content">

        <adm:tab label="#{fxMessageBean['StructureExport.tabtitle.main']}" active="true" id="tab1"
                 bean="#{exportBean}" action="showMainTab" rendered="true" lockscreen="false"/>

        <adm:tab label="#{fxMessageBean['StructureExport.tabtitle.export']}" active="false" id="tab2"
                 bean="#{exportBean}" action="showResultTab" rendered="true" lockscreen="false"/>

        <a4j:outputPanel id="dependencyPanel">
            <fx:fieldSet legendKey="StructureExport.lbl.ignoreDependenciesFieldset">
                <fx:formRow id="ignoreDependencies" labelKey="StructureExport.lbl.ignoreDependencies" newLine="false">
                    <h:selectBooleanCheckbox id="ignoreDependencies" value="#{exportBean.exportWithOutDependencies}"/>
                </fx:formRow>
                <fx:formRow id="showScripts" labelKey="StructureExport.lbl.showScripts">
                    <h:selectBooleanCheckbox id="showScripts" value="#{exportBean.showScripts}"/>
                </fx:formRow>
            </fx:fieldSet>
        </a4j:outputPanel>

        <a4j:outputPanel id="groovyOptionPanel">
            <fx:fieldSet legendKey="StructureExport.lbl.groovyOptions">
                <fx:formRow id="deleteStructures" labelKey="StructureExport.lbl.addDeleteStructures" newLine="false">
                    <h:selectBooleanCheckbox id="deleteStructures" value="#{exportBean.deleteStructures}"/>
                </fx:formRow>

                <fx:formRow id="importStatements" labelKey="StructureExport.lbl.addImportSatements" newLine="false">
                    <h:selectBooleanCheckbox id="importStatements" value="#{exportBean.generateImportStatements}"/>
                </fx:formRow>

                <fx:formRow id="defaultsOnly" labelKey="StructureExport.lbl.defaultsOnly" newLine="false">
                    <h:selectBooleanCheckbox id="defaultsOnly" value="#{exportBean.defaultsOnly}"/>
                </fx:formRow>

                <fx:formRow id="scriptAssignments" labelKey="StructureExport.lbl.scriptAssignments" newLine="false">
                    <h:selectBooleanCheckbox id="scriptAssignments" value="#{exportBean.generateScriptAssignments}"/>
                </fx:formRow>

                <fx:formRow id="addRoot" labelKey="StructureExport.lbl.addRoot" newLine="false">
                    <h:selectBooleanCheckbox id="addroot" value="#{exportBean.addRoot}"/>
                </fx:formRow>
            </fx:fieldSet>
        </a4j:outputPanel>

        <a4j:outputPanel id="typePanel">
            <fx:fieldSet legendKey="StructureExport.lbl.typesDisplay">
                <fx:formRow id="showAllTypes" labelKey="StructureExport.lbl.all">
                    <h:selectBooleanCheckbox id="showAllTypes" value="#{exportBean.showAllTypes}">
                        <a4j:support reRender="typeOverview" event="onchange"
                                     oncomplete="flexive.yui.processOnYahoo();"/>
                    </h:selectBooleanCheckbox>
                </fx:formRow>

                <fx:formRow id="showBaseTypes" labelKey="StructureExport.lbl.base">
                    <h:selectBooleanCheckbox id="showBaseTypes" value="#{exportBean.showBaseTypes}">
                        <a4j:support reRender="typeOverview" event="onchange"
                                     oncomplete="flexive.yui.processOnYahoo();"/>
                    </h:selectBooleanCheckbox>
                </fx:formRow>

                <fx:formRow id="showDerivedTypes" labelKey="StructureExport.lbl.derived">
                    <h:selectBooleanCheckbox id="showDerivedTypes" value="#{exportBean.showDerivedTypes}">
                        <a4j:support reRender="typeOverview" event="onchange"
                                     oncomplete="flexive.yui.processOnYahoo();"/>
                    </h:selectBooleanCheckbox>
                </fx:formRow>

                <fx:formRow id="showRelations" labelKey="StructureExport.lbl.relations">
                    <h:selectBooleanCheckbox id="showRelations" value="#{exportBean.showRelations}" disabled="true">
                        <a4j:support reRender="typeOverview" event="onchange"
                                     oncomplete="flexive.yui.processOnYahoo();"/>
                    </h:selectBooleanCheckbox>
                </fx:formRow>
            </fx:fieldSet>
        </a4j:outputPanel>

        <a4j:outputPanel id="markallpanel" layout="block">
            <fx:fieldSet legendKey="StructureExport.lbl.markallhd">
                <fx:formRow id="markall" labelKey="StructureExport.lbl.markall">
                    <h:selectBooleanCheckbox id="markall" value="#{exportBean.allTypesMarked}">
                        <a4j:support reRender="typeOverview" event="onchange" oncomplete="flexive.yui.processOnYahoo();"
                                     action="#{exportBean.markAllTypes}"/>
                    </h:selectBooleanCheckbox>
                </fx:formRow>
            </fx:fieldSet>
        </a4j:outputPanel>

        <a4j:outputPanel id="typeOverview" layout="block" ajaxRendered="true">

            <adm:sortableTable id="table">
                <table id="table">
                    <thead>
                    <tr>
                        <th class="tblHeader" field="typeId" dataType="String" align="left">
                            #{fxMessageBean['StructureExport.tbl.typeId']}
                        </th>
                        <th class="tblHeader" field="typeName" dataType="String" align="left">
                            #{fxMessageBean['StructureExport.tbl.typeName']}
                        </th>
                        <th class="tblHeader" field="isDerived" dataType="Boolean" align="left">
                            #{fxMessageBean['StructureExport.tbl.typeClass']}
                        </th>
                        <th class="tblHeader" field="markForExport" dataType="boolean" align="left">
                            #{fxMessageBean['StructureExport.tbl.export']}
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <ui:repeat value="#{exportBean.typeList}" var="type">
                        <tr value="#{type.id}">
                            <td align="left">
                                <h:outputText value="#{type.id}"/>
                            </td>
                            <td align="left">
                                <h:outputText value="#{type.name}"/>
                            </td>
                            <td align="left">
                                <h:outputText escape="false"
                                              value="#{fxMessageBean['StructureExport.tbl.isBase']}&lt;br/&gt;"
                                              rendered="#{type.parent eq null and type.mode != 'Relation'}"/>
                                <h:outputText escape="false"
                                              value="#{fxMessageBean['StructureExport.tbl.isDerived']}&lt;br/&gt;"
                                              rendered="#{type.parent ne null}"/>
                                <h:outputText value="#{fxMessageBean['StructureExport.tbl.isRelation']}"
                                              rendered="#{type.mode eq 'Relation'}"/>
                            </td>
                            <td align="left">
                                <h:selectBooleanCheckbox value="#{exportBean.exportIds[type.id]}"
                                                         disabled="#{type.mode eq 'Relation'}"/>
                            </td>
                        </tr>
                    </ui:repeat>
                    </tbody>
                </table>
            </adm:sortableTable>
        </a4j:outputPanel>

        <br/>

        <adm:ajaxCommandButton id="exportButton" bean="#{exportBean}" action="export"
                               labelKey="StructureExport.btn.export" icon="export"
                               oncomplete="flexive.yui.processOnYahoo();"/>

        <div id="xmlexport">
            <adm:ajaxCommandButton id="exportButtonXML" bean="#{exportBean}" action="exportAsXML"
                                   labelKey="StructureExport.btn.exportXML" icon="export"
                                   oncomplete="exportType('#{exportBean.typeIdsXML}'); flexive.yui.processOnYahoo();"/>

        </div>
        <rich:toolTip for="xmlexport" layout="block" styleClass="tooltip" direction="top-right">
            #{fxMessageBean['StructureExport.btn.exportXML.tooltip']}
        </rich:toolTip>

    </ui:define>

</ui:composition>
</html>
