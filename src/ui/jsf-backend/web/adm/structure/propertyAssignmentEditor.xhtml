<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:adm="http://www.flexive.com/jsf/admin"
      xmlns:fx="http://www.flexive.com/jsf/core">
<body>

<ui:composition template="/adm/contentTemplate.xhtml">
      <ui:define name="head">
        <t:stylesheet path="/adm/css/content.css"/>
        <t:stylesheet path="/adm/css/structureEditor.css"/>
      </ui:define>

    <ui:define name="body">
        <a4j:form id="frm" enctype="multipart/form-data">
            <c:if test="#{empty propertyEditorBean.parseRequestParameters}"> </c:if>
            <h:panelGroup rendered="#{structureTreeControllerBean.doAction}">
                <script type="text/javascript">
                    var treeframe=parent.getStructureNavFrame();
                    treeframe.doTreeAction('#{structureTreeControllerBean.action}',#{structureTreeControllerBean.id}, '#{structureTreeControllerBean.value}');
                </script>
            </h:panelGroup>
            <ui:fragment rendered="#{propertyEditorBean.editMode}">
                <adm:tab label="#{fxMessageBean['PropertyEditor.tab.propertyAssignment']}" active="true" id="tab1"/>
                <adm:tab label="#{fxMessageBean['PropertyEditor.tab.property']}" active="false" id="tab2"
                         bean="#{propertyEditorBean}" action="showPropertyEditor"/>
                <adm:tab label="#{fxMessageBean['PropertyEditor.tab.option']}" active="false" id="tab3"
                         bean="#{propertyEditorBean}" action="showPropertyOptionEditor"/>
                <adm:tab label="#{fxMessageBean['ScriptEditor.tab.scriptEditor']} [#{propertyEditorBean.scriptCount}]" active="false" id="tab4"
                         bean="#{propertyEditorBean}" action="showAssignmentScriptEditor"/>
            </ui:fragment>
            <ui:fragment rendered="#{not propertyEditorBean.editMode}">
                <adm:tab label="#{fxMessageBean['PropertyEditor.tab.propertyAssignment.readonly']}" active="true" id="tab1ro"/>
                <adm:tab label="#{fxMessageBean['PropertyEditor.tab.property.readonly']}" active="false" id="tab2ro"
                         bean="#{propertyEditorBean}" action="showPropertyEditor"/>
                <adm:tab label="#{fxMessageBean['PropertyEditor.tab.option.readonly']}" active="false" id="tab3ro"
                         bean="#{propertyEditorBean}" action="showPropertyOptionEditor"/>
                <adm:tab label="#{fxMessageBean['ScriptEditor.tab.scriptEditor.readonly']} [#{propertyEditorBean.scriptCount}]" active="false" id="tab4ro"
                         bean="#{propertyEditorBean}" action="showAssignmentScriptEditor"/>
            </ui:fragment>

            <fx:formRow labelKey="PropertyEditor.label.xPath" id="xPath">
                    <h:outputText id="xPath" value="#{propertyEditorBean.assignment.XPath}"/>
            </fx:formRow>

            <ui:fragment rendered="#{propertyEditorBean.assignment.derivedAssignment}">
                <fx:formRow labelKey="PropertyEditor.label.xPathBase" id="xPathBase">
                    <h:commandLink id="gotoPropertyAssignmentButton_#{propertyEditorBean.assignment.baseAssignmentId}"
                                   onclick="var treeframe=parent.getStructureNavFrame(); treeframe.selectNode(#{propertyEditorBean.assignment.baseAssignmentId}, false);">
                        <h:outputText id="xPathBase" value="#{propertyEditorBean.baseAssignmentXPath}"/>
                    </h:commandLink>
                </fx:formRow>
            </ui:fragment>

            <fx:formRow labelKey="PropertyEditor.label.label" id="label">
                    <fx:fxValueInput id="label" value="#{propertyEditorBean.label}"
                         readOnly="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"/>
            </fx:formRow>
            <fx:formRow labelKey="PropertyEditor.label.alias" id="alias">
                    <h:inputText id="alias" value="#{propertyEditorBean.alias}"
                         disabled="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"/>
            </fx:formRow>
            <fx:formRow labelKey="PropertyEditor.label.hint" id="hint">
                    <fx:fxValueInput id="hint" value="#{propertyEditorBean.hint}"
                             readOnly="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"/>
            </fx:formRow>

            <fx:formRow labelKey="PropertyEditor.label.propertyDataType" id="propertyDataType">
                <fx:resultValue id="propertyDataType" value="#{propertyEditorBean.property.dataType.name}"/>
            </fx:formRow>
            <div style="padding-left:17px">
                <ui:fragment rendered="#{propertyEditorBean.propertyReference}">
                    <fx:formRow labelKey="PropertyEditor.label.referencedType" id="referencedType">
                        <a href="javascript:var treeframe=parent.getStructureNavFrame(); treeframe.openNode(#{propertyEditorBean.propertyReferencedType}, true);">
                                <h:outputText value="#{propertyEditorBean.propertyReferencedTypeName}"/>
                        </a>
                    </fx:formRow>
                </ui:fragment>
            </div>

            <fx:formRow labelKey="PropertyEditor.label.setDefaultValue" id="defaultValue">
                <h:selectBooleanCheckbox id="defaultValue" value="#{propertyEditorBean.defaultValueSet}"
                         disabled="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}">
                    <a4j:support event="onclick" reRender="multiLangBox,defaultLangSelect,defaultValueInput,defaultLanguageInput"/>
                </h:selectBooleanCheckbox>
            </fx:formRow>

            <a4j:outputPanel id="defaultValueInput">
                <ui:fragment rendered="#{propertyEditorBean.defaultValueSet}">
                    <fx:formRow labelKey="PropertyEditor.label.defaultValue" id="defaultValueSelect">
                       <fx:fxValueInput id="defaultValueSelect" value="#{propertyEditorBean.defaultValue}"
                                 readOnly="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"/>
                    </fx:formRow>
                </ui:fragment>
            </a4j:outputPanel>


            <a4j:outputPanel id="defaultLangSelect">
                <fx:formRow labelKey="PropertyEditor.label.defaultLanguage" id="defaultLanguage">
                    <ui:fragment rendered="#{propertyEditorBean.multiLang}">
                        <t:selectOneListbox size="1" id="defaultLanguage" value="#{propertyEditorBean.defaultLanguage}"
                            converter="FxLanguageConverter"
                            disabled="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}">
                            <f:selectItems value="#{fxSelectBean.languages}" />
                        </t:selectOneListbox>
                    </ui:fragment>
                    <ui:fragment rendered="#{not propertyEditorBean.multiLang}">
                        <h:outputText value="#{fxMessageBean['PropertyEditor.label.multilang.disabled']}"/>
                    </ui:fragment>
                </fx:formRow>
            </a4j:outputPanel>

            <fx:formRow labelKey="PropertyEditor.label.defaultMultiplicity" id="defaultMultiplicity">
                <h:inputText id="defaultMultiplicity" value="#{propertyEditorBean.defaultMultiplicity}"
                     disabled="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"
                     required="true" style="width:40px"/>
            </fx:formRow>

             <fx:formRow labelKey="PropertyEditor.label.enabled" id="enabled">
                <h:selectBooleanCheckbox id="enabled" value="#{propertyEditorBean.enabled}"
                        disabled="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"/>
            </fx:formRow>

            <fx:fieldSet legend="#{fxMessageBean['PropertyEditor.label.overridePropertyOptions']}">
                <fx:formRow labelKey="PropertyEditor.label.overrideMultiLang" id="overrideMultiLang">
                        <h:selectBooleanCheckbox id="overrideMultiLang" value="#{propertyEditorBean.overrideMultiLang}"
                             disabled="#{not propertyEditorBean.propertyMayOverrideMultiLang or not
                             propertyEditorBean.editMode or (propertyEditorBean.systemInternal
                             and not fxSystemBean.isInRole['GlobalSupervisor'])}">
                            <a4j:support event="onclick" reRender="multiLangBox,defaultLangSelect,defaultValueInput,defaultLanguageInput"/>
                        </h:selectBooleanCheckbox>
                </fx:formRow>

                <a4j:outputPanel id="multiLangBox">
                    <ui:fragment rendered="#{propertyEditorBean.overrideMultiLang}">
                        <div style="padding-left:17px">
                            <fx:formRow labelKey="PropertyEditor.label.multiLang" id="multiLang">
                                    <h:selectBooleanCheckbox id="multiLang" value="#{propertyEditorBean.assignmentMultiLang}"
                                         disabled="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}">
                                        <a4j:support event="onclick" reRender="defaultLangSelect,defaultValueInput,defaultLanguageInput"/>
                                    </h:selectBooleanCheckbox>
                            </fx:formRow>
                        </div>
                    </ui:fragment>
                </a4j:outputPanel>

                <fx:formRow labelKey="PropertyEditor.label.overrideBaseMultiplicity" id="overrideBaseMultiplicity">
                        <h:selectBooleanCheckbox id="overrideBaseMultiplicity" value="#{propertyEditorBean.overrideMultiplicity}"
                             disabled="#{not propertyEditorBean.propertyMayOverrideBaseMultiplicity
                                or not propertyEditorBean.editMode or (propertyEditorBean.systemInternal
                                and not fxSystemBean.isInRole['GlobalSupervisor'])}">
                                 <a4j:support event="onclick" reRender="multiplicitySelect"/>
                             </h:selectBooleanCheckbox>
                </fx:formRow>

                <a4j:outputPanel id="multiplicitySelect">
                    <ui:fragment rendered="#{propertyEditorBean.overrideMultiplicity}">
                        <div style="padding-left:17px">
                            <fx:formRow labelKey="PropertyEditor.label.multiplicity" id="multiplicity">
                                <h:inputText id="minMultiplicity" value="#{propertyEditorBean.minMultiplicity}"
                                         disabled="#{not propertyEditorBean.editMode or not propertyEditorBean.propertyMayOverrideBaseMultiplicity or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"
                                         required="true" style="width:40px">
                                </h:inputText>
                                <h:inputText value="#{propertyEditorBean.maxMultiplicity}" id="maxMultiplicity"
                                                disabled="#{not propertyEditorBean.editMode or not propertyEditorBean.propertyMayOverrideBaseMultiplicity or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}"
                                                required="true" style="width:40px">
                                </h:inputText>
                            </fx:formRow>
                        </div>
                    </ui:fragment>
                </a4j:outputPanel>

                <fx:formRow labelKey="PropertyEditor.label.overrideACL" id="overrideACL">
                        <h:selectBooleanCheckbox id="overrideACL" value="#{propertyEditorBean.overrideACL}"
                             disabled="#{not propertyEditorBean.propertyMayOverrideACL or not
                             propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not
                             fxSystemBean.isInRole['GlobalSupervisor'])}">
                                <a4j:support event="onclick" reRender="aclSelect"/>
                             </h:selectBooleanCheckbox>
                </fx:formRow>

                <a4j:outputPanel id="aclSelect">
                    <ui:fragment rendered="#{propertyEditorBean.overrideACL}">
                         <div style="padding-left:17px">
                            <fx:formRow labelKey="PropertyEditor.label.acl" id="acl">
                                <t:selectOneListbox size="1" id="acl" value="#{propertyEditorBean.acl}"
                                        disabled="#{not propertyEditorBean.editMode or (propertyEditorBean.systemInternal and not fxSystemBean.isInRole['GlobalSupervisor'])}">
                                    <f:selectItems value="#{fxSelectBean.structureACLs}" />
                                </t:selectOneListbox>
                            </fx:formRow>
                        </div>
                    </ui:fragment>
                </a4j:outputPanel>
            </fx:fieldSet>

            <ui:fragment rendered="#{propertyEditorBean.structureManagement and not propertyEditorBean.editMode}">
                <adm:commandButton labelKey="PropertyEditor.button.editMode" location="both"
                        icon="edit"  action="toggleEditMode"  bean="#{propertyEditorBean}" id="editModeButton"/>
            </ui:fragment>

            <ui:fragment rendered="#{propertyEditorBean.structureManagement and propertyEditorBean.editMode}">
                <adm:commandButton labelKey="PropertyEditor.button.save" location="both" 
                                icon="save"  action="saveChanges"  bean="#{propertyEditorBean}" id="saveChangesButton">
                </adm:commandButton>
           </ui:fragment>
             <ui:fragment rendered="#{propertyEditorBean.structureManagement and propertyEditorBean.editMode}">
                <adm:commandButton labelKey="PropertyEditor.button.delete.assignment" location="both" lockscreen="false"
                                icon="delete" onclick="parent.getStructureNavFrame()._deleteAssignment(#{propertyEditorBean.assignment.id});return false;"
                                id="deleteAssignmentButton">
                </adm:commandButton>
           </ui:fragment>

            <ui:fragment rendered="#{propertyEditorBean.editMode}">
                <adm:commandButton labelKey="PropertyEditor.button.cancel" location="both"
                        icon="cancel" id="cancelButton" lockscreen="false"
                        onclick="parent.getStructureNavFrame().openNode(#{propertyEditorBean.assignment.id}, false);return false;"/>
            </ui:fragment>

            <!-- help button-->
            <ui:include src="../templates/structureEditorHelpButton.xhtml"/>

            <adm:toolbarPluginButtons/>
        </a4j:form>


        <script type="text/javascript">
            function getNewLabel() {
                alert(document.getElementById("frm:label"));
                return document.getElementById("frm:label").value;
            }
            
        </script>

    </ui:define>
</ui:composition>
</body>
</html>
