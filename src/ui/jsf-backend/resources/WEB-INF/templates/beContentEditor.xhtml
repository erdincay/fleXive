<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:adm="http://www.flexive.com/jsf/admin"
      xmlns:fx="http://www.flexive.com/jsf/core">
The backend content editor

Params:
disableTab... false if the <adm:tab/> component should be rendered, true otherwise

<ui:composition>
    <c:set var="srcEditor" value="#{beContentEditorBean}"/>
    <fx:contentEditor typeId="#{srcEditor.typeId == -1 ? null : srcEditor.typeId}" pk="#{srcEditor.pk}" var="myContent"
                      content="#{srcEditor.content}" editorId="#{srcEditor.editorId}" formPrefix="#{srcEditor.formId}"
                      editMode="#{srcEditor.editMode}" disableMessages="true" valueFormatter="#{srcEditor.valueFormatter}"
                      reRender="#{srcEditor.editorId}" reset="#{srcEditor.reset}">

        <!-- replace default insertTop settings -->
        <ui:define name="insertTop">
        </ui:define>
        <!-- replace default content settings -->
        <ui:define name="contentSettings">
            <!-- Content editor tabs -->
            <c:if test="#{not myContent.referenced}">
                <adm:tab active="true" id="tabContentEditor"
                    label="#{myContent.new ? fxMessageBean['Content.tabtitle.new'] :
                        myContent.guiSettings.editMode ?
                        fxMessageBean['Content.tabtitle.edit,#{myContent.content.pk.id},#{myContent.content.pk.version}'] :
                        fxMessageBean['Content.tabtitle.readonly,#{myContent.content.pk.id},#{myContent.content.pk.version}']}"
                    rendered="#{not disableTab}"/>
             </c:if>

                <ui:fragment rendered="#{not myContent.new}">
                    <!-- export functionality -->
                    <div style="display:none;"><iframe id="exportFrame" ><!--empty--></iframe></div>
                    <c:if test="#{not myContent.referenced}">
                        <!-- content navigation -->
                        <adm:contentNavigation pk="#{myContent.content.pk}"/>
                        <!-- info panel -->
                        <adm:contentInfoPanel srcEditor="#{srcEditor}" wrappedContent="#{myContent}"/>
                    </c:if>
                </ui:fragment>
                <!-- content settings -->
                <div class="contentSettings">
                    <div style="float:left;padding-right:50px">
                        <!-- Type name and small type icon -->
                        <fx:formRow labelKey="Content.field.type">
                            <ui:fragment rendered="#{not empty myContent.typeIcon}">
                                <fx:thumbnail pk="#{myContent.typeIcon}" previewSize="original" width="16" height="16"/>
                            </ui:fragment>
                            #{not empty fxMapBean.types[myContent.content.typeId].label ?
                                fxMapBean.types[myContent.content.typeId].label :
                                fxMapBean.types[myContent.content.typeId].name}
                        </fx:formRow>

                        <!-- ACL -->
                        <ui:fragment rendered="#{not myContent.supportSecurity}">
                            <em>#{fxMessageBean['Content.msg.noSecurity']}</em>
                        </ui:fragment>
                        <ui:fragment rendered="#{myContent.supportSecurity}">
                            <ui:fragment rendered="#{not myContent.multipleContentACLs}">
                                <fx:formRow labelKey="ContentEditor.field.ACL" id="#{myContent.editorId}_acl">
                                     <h:selectOneListbox id="#{myContent.editorId}_acl" size="1" value="#{myContent.aclId}"
                                                        disabled="#{not myContent.guiSettings.editMode or not empty myContent.guiSettings.openedReferenceId}">
                                        <f:selectItems value="#{fxSelectBean.contentACLs}"/>
                                    </h:selectOneListbox>
                                </fx:formRow>
                            </ui:fragment>
                            <ui:fragment rendered="#{myContent.multipleContentACLs}">
                                <fx:formRow labelKey="ContentEditor.field.ACL" id="#{myContent.editorId}_acls">
                                     <h:selectManyListbox id="#{myContent.editorId}_acls" size="4" value="#{myContent.aclIds}"
                                                        disabled="#{not myContent.guiSettings.editMode or not empty myContent.guiSettings.openedReferenceId}">
                                        <f:selectItems value="#{fxSelectBean.contentACLs}"/>
                                    </h:selectManyListbox>
                                </fx:formRow>
                            </ui:fragment>
                        </ui:fragment>

                        <!-- wf step -->
                        <fx:formRow labelKey="Content.field.step" id="#{myContent.editorId}_step">
                             <h:selectOneListbox size="1" id="#{myContent.editorId}_step" value="#{myContent.step}"
                                                 disabled="#{not myContent.guiSettings.editMode or
                                                 not empty myContent.guiSettings.openedReferenceId}">
                                <f:selectItems value="#{myContent.possibleWorkflowSteps}"/>
                            </h:selectOneListbox>
                        </fx:formRow>

                        <!-- locks -->
                        <ui:fragment rendered="#{not _ceContent.new}">
                            <fx:formRow labelKey="ContentEditor.field.lockAdmin">
                                <c:set var="buttonStyle" value="float:left;"/>
                                <!-- lock status message -->
                                <ui:fragment rendered="#{not empty _ceContent.guiSettings.lockStatus and not _ceContent.new}">
                                    <div style="float:left; padding-top:5px; padding-right:5px;">
                                        <h:outputText value="#{_ceContent.guiSettings.lockStatus}" title="#{_ceContent.guiSettings.lockStatusTooltip}"/>
                                    </div>
                                </ui:fragment>
                                <!-- take over lock button -->
                                <ui:fragment rendered="#{_ceContent.guiSettings.userMayTakeover}">
                                    <div style="#{buttonStyle}">
                                        <adm:ajaxCommandIcon id="#{editorId}_overrideButton" titleKey="ContentEditor.button.lockOverride.title"
                                                               bean="#{srcEditor}" icon="unlock" action="lockOverride"
                                                               onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                                               oncomplete="#{jsfunc}">
                                            <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                                            <!-- set properties for fxContentEditorBean -->
                                            <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                            <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                        </adm:ajaxCommandIcon>
                                    </div>
                                </ui:fragment>
                                <!-- loose lock button -->
                                <ui:fragment rendered="#{not _ceContent.guiSettings.looseLock and _ceContent.guiSettings.userMayLooseLock}">
                                    <div style="#{buttonStyle}">
                                        <adm:ajaxCommandIcon id="#{editorId}_looseLockButton" titleKey="ContentEditor.button.acquireLooseLock.title"
                                                               bean="#{srcEditor}" icon="looseLock" action="acquireLooseLock"
                                                               onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                                               oncomplete="#{jsfunc}">
                                            <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                                            <!-- set properties for fxContentEditorBean -->
                                            <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                            <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                        </adm:ajaxCommandIcon>
                                    </div>
                                </ui:fragment>
                                <!-- permanent lock button -->
                                <ui:fragment rendered="#{not _ceContent.guiSettings.permLock and _ceContent.guiSettings.userMayPermLock}">
                                    <div style="#{buttonStyle}">
                                        <adm:ajaxCommandIcon id="#{editorId}_permLockButton" titleKey="ContentEditor.button.acquirePermLock.title"
                                                             bean="#{srcEditor}" icon="lock" action="acquirePermLock"
                                                             onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                                             oncomplete="#{jsfunc}">
                                            <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                                            <!-- set properties for fxContentEditorBean -->
                                            <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                            <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                        </adm:ajaxCommandIcon>
                                    </div>
                                </ui:fragment>
                                <!-- lock duration & extension -->
                                <ui:fragment rendered="#{_ceContent.guiSettings.contentLocked}">
                                    <div id="#{editorId}_lockTimeAndUnlock" style="#{buttonStyle}">
                                        <!-- lock duration -->
                                        <adm:ajaxCommandIcon id="#{editorId}_lockTimeButton" titleKey="ContentEditor.button.remainingTime" bean="#{srcEditor}"
                                                               icon="time" action="computeRemainingLockTime" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                                               oncomplete="#{jsfunc}">
                                             <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                                             <!-- set properties for fxContentEditorBean -->
                                            <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                            <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                        </adm:ajaxCommandIcon>
                                        <!-- extend lock -->
                                        <adm:ajaxCommandIcon id="#{editorId}_extendLockTimeButton"
                                                             titleKey="ContentEditor.button.extendLock" bean="#{srcEditor}"
                                                             icon="timeExtend" action="extendLock"
                                                             onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                                             oncomplete="#{jsfunc}">
                                            <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                                            <!-- set properties for fxContentEditorBean -->
                                            <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                            <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                        </adm:ajaxCommandIcon>
                                        <!-- unlock button -->
                                        <ui:fragment rendered="#{not myContent.guiSettings.editMode and myContent.guiSettings.userMayUnlock}">
                                            <adm:ajaxCommandIcon id="#{editorId}_unlockButton"
                                                                 titleKey="ContentEditor.button.unlock" bean="#{srcEditor}"
                                                                 icon="unlock" action="unLock"
                                                                 onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                                                 oncomplete="#{jsfunc}">
                                                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                                                <!-- set properties for fxContentEditorBean -->
                                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                            </adm:ajaxCommandIcon>
                                        </ui:fragment>
                                    </div>
                                    <!-- lock duration panel -->
                                    <a4j:outputPanel id="#{editorId}_lockDurationPanel" rendered="#{not empty __ceBean.remainingLockTime and not empty __ceBean.expiresTime}">
                                        <br/><br/>
                                        <c:if test="#{_ceContent.guiSettings.permLock}">
                                            <h:outputText value="#{fxMessageBean['ContentEditor.msg.permLockTimeRemaining']}"/>
                                        </c:if>
                                        <c:if test="#{_ceContent.guiSettings.looseLock}">
                                            <h:outputText value="#{fxMessageBean['ContentEditor.msg.looseLockTimeRemaining']}"/>
                                        </c:if>
                                        <h:outputText value=" #{__ceBean.remainingLockTime} #{fxMessageBean['ContentEditor.msg.expiresAt']} #{__ceBean.expiresTime}"/>
                                    </a4j:outputPanel>
                                </ui:fragment>
                            </fx:formRow>
                        </ui:fragment>

                        <c:if test="#{not myContent.referenced}">
                            <fx:formRow labelKey="Content.field.nodes">
                                <adm:renderTreeNodes srcEditor="#{srcEditor}" readOnly="#{not myContent.guiSettings.editMode}"/>
                            </fx:formRow>
                        </c:if>
                    </div>

                    <!-- Preview Image -->
                    <ui:fragment rendered="#{myContent.content.previewAvailable}">
                        <div class="previewImage">
                            <a rel="lytebox" href="thumbnail/pk#{myContent.content.pk.id}.#{myContent.content.pk.version}/s4/ts#{fxSystemBean.currentTimeMillis}">
                                <img src="thumbnail/pk#{myContent.content.pk.id}.#{myContent.content.pk.version}/s2/ts#{fxSystemBean.currentTimeMillis}"
                                     alt="#{fxMessageBean['Content.preview.title']}" title="#{fxMessageBean['Content.preview.title']}"/>
                            </a>
                            <div style="padding-top:6px">
                                <strong>#{fxMessageBean['Content.field.previewImage']}</strong>
                            </div>
                        </div>
                    </ui:fragment>

                     <!--ie surrounding div height fix-->
                    <div style="clear:both;height:0"><!-- __ --></div>
                </div>
        </ui:define>

        <!-- replace default buttons -->
        <ui:define name="editButton">
            <adm:commandButton id="#{editorId}_editButton"
                  labelKey="Content.button.edit" location="#{not myContent.referenced ? 'both' : 'content'}"
                  bean="#{srcEditor}" icon="edit" action="enableEdit" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>

        <ui:define name="createButton">
            <adm:commandButton id="#{editorId}_createButton" labelKey="Content.button.create"
                      location="#{empty myContent.guiSettings.openedReferenceId
                      and not myContent.referenced ? 'both' : 'content'}"
                      bean="#{srcEditor}"
                      icon="new" action="save" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>

        <ui:define name="saveButton">
            <adm:commandButton id="#{editorId}_saveButton"
                               labelKey="Content.button.save"
                               location="#{empty myContent.guiSettings.openedReferenceId
                               and not myContent.referenced ? 'both' : 'content'}"
                               bean="#{srcEditor}"
                               icon="save" action="save" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>

        <ui:define name="saveInNewVersionButton">
            <adm:commandButton id="#{editorId}_saveInNewVersionButton"
                    labelKey="Content.button.saveInNewVersion"
                              location="#{empty myContent.guiSettings.openedReferenceId
                              and not myContent.referenced ? 'both' : 'content'}"
                              bean="#{srcEditor}"
                              icon="newVersion" action="saveInNewVersion" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>
        <!-- delete button -->
        <ui:define name="deleteButton">
            <adm:commandButton id="#{editorId}_deleteButton" labelKey="Content.button.delete"
                               location="#{empty myContent.guiSettings.openedReferenceId
                                         and not myContent.referenced ? 'both' : 'content'}"
                       bean="#{srcEditor}" confirmKey="Content.confirm.delete"
                       icon="delete" action="delete" ajax="true">
                 <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>

        <ui:define name="deleteVersionButton">
            <adm:commandButton id="#{editorId}_deleteVersionButton" labelKey="Content.button.deleteVersion"
                               location="#{empty myContent.guiSettings.openedReferenceId
                                         and not myContent.referenced ? 'both' : 'content'}"
                       bean="#{srcEditor}" confirmKey="Content.confirm.deleteVersion"
                       icon="deleteVersion" action="deleteCurrentVersion" ajax="true">
                 <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>

        <ui:define name="compactButton">
            <adm:commandButton id="#{editorId}_compactButton" labelKey="Content.button.compact"
                          location="#{empty myContent.guiSettings.openedReferenceId
                                         and not myContent.referenced ? 'both' : 'content'}"
                          bean="#{srcEditor}" separator="before"
                          icon="compact" action="compact" ajax="true">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>

        <ui:define name="cancelButton">
            <adm:commandButton id="#{editorId}_saveAndCancelButton" labelKey="ContentEditor.button.saveAndCancel"
                          location="#{empty myContent.guiSettings.openedReferenceId
                                         and not myContent.referenced ? 'both' : 'content'}"
                          bean="#{srcEditor}" icon="save" action="saveAndCancel"
                          onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');ceReloadTree();">
                 <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                 <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
            <adm:commandButton id="#{editorId}_cancelButton" labelKey="Content.button.cancel"
                          location="#{empty myContent.guiSettings.openedReferenceId
                                         and not myContent.referenced ? 'both' : 'content'}"
                          bean="#{srcEditor}" confirmKey="Content.confirm.abort"
                          icon="cancel" action="cancel" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');ceReloadTree();">
                 <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                 <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:commandButton>
        </ui:define>
        <!-- take over lock button -->
        <ui:define name="takeoverButton">
            <ui:fragment rendered="#{not myContent.guiSettings.editMode and _ceContent.guiSettings.userMayTakeover}">
                <adm:ajaxCommandButton id="#{editorId}_overrideButtonBottom" labelKey="ContentEditor.button.lockOverride"
                                       bean="#{srcEditor}" icon="unlock" action="lockOverride"
                                       onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                       oncomplete="#{jsfunc}">
                    <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                    <!-- set properties for fxContentEditorBean -->
                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                </adm:ajaxCommandButton>
            </ui:fragment>
        </ui:define>
        <!-- acquire permanent lock -->
        <ui:define name="permLockButton">
            <ui:fragment rendered="#{not myContent.guiSettings.editMode and _ceContent.guiSettings.userMayPermLock}">
                <adm:ajaxCommandButton id="#{editorId}_permLockButtonBottom" labelKey="ContentEditor.button.acquirePermLock" bean="#{srcEditor}"
                                       icon="lock" action="acquirePermLock" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                       oncomplete="#{jsfunc}">
                     <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                     <!-- set properties for fxContentEditorBean -->
                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                </adm:ajaxCommandButton>
            </ui:fragment>
        </ui:define>
        <!-- acquire loose lock -->
        <ui:define name="looseLockButton">
            <ui:fragment rendered="#{not myContent.guiSettings.editMode and _ceContent.guiSettings.userMayLooseLock}">
                <adm:ajaxCommandButton id="#{editorId}_looseLockButtonBottom" labelKey="ContentEditor.button.acquireLooseLock" bean="#{srcEditor}"
                                       icon="looseLock" action="acquireLooseLock" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                       oncomplete="#{jsfunc}">
                     <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                     <!-- set properties for fxContentEditorBean -->
                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                </adm:ajaxCommandButton>
            </ui:fragment>
        </ui:define>
        <!-- unlock content -->
        <ui:define name="unlockButton">
            <ui:fragment rendered="#{not myContent.guiSettings.editMode and _ceContent.guiSettings.userMayUnlock}">
                <adm:ajaxCommandButton id="#{editorId}_unlockButtonBottom" labelKey="ContentEditor.button.unlock" bean="#{srcEditor}"
                                       icon="unlock" action="unLock" onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');"
                                       oncomplete="#{jsfunc}">
                     <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                     <!-- set properties for fxContentEditorBean -->
                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                </adm:ajaxCommandButton>
            </ui:fragment>
        </ui:define>
        <!-- remaining lock time button -->
        <ui:define name="lockTimeButton">
        </ui:define>
        <!-- extend lock time button -->
        <ui:define name="extendLockTimeButton">
        </ui:define>
        <!-- lock time display panel -->
        <ui:define name="lockTimePanel">
        </ui:define>
        <!-- editLockedContentButtons -->
        <ui:define name="editLockedContentButtons">
            <br/><br/><br/>
            <div>
                <c:if test="#{_ceContent.guiSettings.looseLock}">
                    <h:outputText escape="false" value=" #{fxMessageBean['ContentEditor.msg.looseLock.takeover']} "/>
                </c:if>
                <c:if test="#{_ceContent.guiSettings.permLock}">
                    <h:outputText escape="false" value=" #{fxMessageBean['ContentEditor.msg.permLock.takeover']} "/>
                </c:if>
            </div>
            <adm:ajaxCommandButton id="#{editorId}_askLockOverrideButtonYes" labelKey="ContentEditor.button.lockOverrideYes"
                                   bean="#{srcEditor}" icon="ok" action="lockOverrideAndEdit" oncomplete="#{jsfunc}" reRender="#{__ce_reRender}">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                 <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:ajaxCommandButton>
            <adm:ajaxCommandButton id="#{editorId}_askLockOverrideButtonNo" labelKey="ContentEditor.button.lockOverrideNo"
                                   bean="#{srcEditor}" icon="cancel" action="noLockOverride" oncomplete="#{jsfunc}">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                 <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:ajaxCommandButton>
        </ui:define>

        <!-- editLockedContentNewVersionButtons -->
        <ui:define name="editLockedContentNewVersionButtons">
            <br/><br/><br/>
            <div>
                <h:outputText value=" #{fxMessageBean['ContentEditor.msg.askCreateNewVersion']} "/>
            </div>
            <adm:ajaxCommandButton id="#{editorId}_askNewVersionButtonYes" labelKey="ContentEditor.button.askCreateNewVersionYes"
                                   bean="#{srcEditor}" icon="ok" action="enableEditInNewVersion" oncomplete="#{jsfunc}" reRender="#{__ce_reRender}">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                 <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:ajaxCommandButton>
            <adm:ajaxCommandButton id="#{editorId}_askNewVersionButtonNo" labelKey="ContentEditor.button.askCreateNewVersionNo"
                                   bean="#{srcEditor}" icon="cancel" action="cancel" oncomplete="#{jsfunc}">
                <f:setPropertyActionListener value="#{myContent}" target="#{srcEditor.wrappedContent}"/>
                 <!-- set properties for fxContentEditorBean -->
                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
            </adm:ajaxCommandButton>
        </ui:define>

        <!-- additional buttons -->
        <ui:define name="additionalButtons">
            <ui:fragment rendered="#{not myContent.new and myContent.content.permissions.mayExport
                and empty myContent.guiSettings.openedReferenceId}">
                <adm:commandButton id="#{editorId}_exportButton" labelKey="Content.button.export"
                                lockscreen="false" location="#{empty myContent.guiSettings.openedReferenceId
                                         and not myContent.referenced ? 'both' : 'content'}"
                               icon="export" separator="#{not myContent.referenced ? 'before' : ''}"
                               onclick="exportContent('#{myContent.content.pk}');return false;"
                               ajax="true">
                </adm:commandButton>
            </ui:fragment>
        </ui:define>

        <!-- replace ajax open and edit reference command links
        to submit whole form, so that action bar buttons are (re-)rendered correctly -->
        <ui:define name="editReferenceButton">
            <h:commandLink action="#{__ceBean.editReference}"
                             title="#{fxMessageBean['ContentEditor.button.editReference.title']}"
                             styleClass="fxContentEditor_editReferenceIcon"
                             rendered="#{empty _ceContent.guiSettings.openedReferenceId and not _ceContent.data[element.XPathFull].isEmpty}"
                             onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');">
                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                    <f:setPropertyActionListener value="#{element}" target="#{__ceBean.element}"/>
           </h:commandLink>
        </ui:define>

        <ui:define name="newReferenceButton">
            <ui:fragment rendered="#{empty _ceContent.guiSettings.openedReferenceId}">
                <h:commandLink action="#{__ceBean.createReference}"
                        title="#{fxMessageBean['ContentEditor.button.newReference.title']}"
                        styleClass="fxContentEditor_newReferenceIcon"
                        onclick="flexive.contentEditor.saveGroupFolding('#{srcEditor.formId}');">
                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                    <f:setPropertyActionListener value="#{element}" target="#{__ceBean.element}"/>
                </h:commandLink>
            </ui:fragment>
        </ui:define>

    </fx:contentEditor>
</ui:composition>

</html>
