<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:fx="http://www.flexive.com/jsf/core"
      xmlns:adm="http://www.flexive.com/jsf/admin"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:jstl="http://java.sun.com/jsp/jstl/functions">

<ui:composition>
       <c:if test="#{empty srcEditor.parseRequestParameters}"> </c:if>
            <t:inputHidden id="editorType" value="#{srcEditor.editorType}" />

            <!-- Content select screen -->
            <ui:fragment rendered="#{srcEditor.initialized==false}">
                <adm:tab label="#{fxMessageBean['Content.tabtitle.chooseType']}" active="true" id="tabChoose"/>
                <t:selectOneListbox size="1" id="type" value="#{srcEditor.type}">
                    <f:selectItems value="#{srcEditor.editableTypes}" />
                </t:selectOneListbox>
                <br/><br/>
                <adm:commandButton labelKey="Content.button.create" location="both"
                                  bean="#{srcEditor}"
                                  icon="save" action="initNew" id="initButton"/>
            </ui:fragment>

            <!-- Content editor screen -->
            <ui:fragment rendered="#{srcEditor.initialized==true}">
                <c:set var="currentId" value="${srcEditor.id}"/>
                <ui:fragment rendered="#{srcEditor.new}">
                    <adm:tab label="#{fxMessageBean['Content.tabtitle.new']}" active="true" id="tabEditNew"/>
                </ui:fragment>
                <ui:repeat var="srcEditor" value="#{srcEditor}">
                    <ui:fragment rendered="#{srcEditor.new==false}">
                        <ui:fragment rendered="#{srcEditor.readOnly==true}">
                            <adm:tab label="#{fxMessageBean['Content.tabtitle.readonly,#{srcEditor.id},#{srcEditor.version}']}"
                                    active="true" id="tabEditInit1"/>
                        </ui:fragment>
                        <ui:fragment rendered="#{srcEditor.readOnly==false}">
                            <adm:tab label="#{fxMessageBean['Content.tabtitle.edit,#{srcEditor.id},#{srcEditor.version}']}"
                                    active="true" id="tabEditInit2"/>
                        </ui:fragment>
                    </ui:fragment>
                </ui:repeat>


                    <a4j:outputPanel id="all">

                        <script type="text/javascript">
                            <!--

                            function startUpload(id) {
                                var _iframe = window.frames['fileupload'+id].document;
                                if (_iframe.getElementById('theFile').value=='') {
                                    alert('Please select a file first');
                                } else {
                                    parent.lockScreen();
                                    _iframe.getElementById('myForm').submit();
                                    document.getElementById("uploadInfo"+id).innerHTML='uploading...';
                                }
                            }

                            function uploadFinished() {
                                document.getElementById("frm:storeButton").onclick();
                            }

                            // to identify the content editor from other frames
                            var isContentEditor = true;
                            var isReadOnly = #{srcEditor.readOnly};
                            var form = document.forms["frm"];

                            function addTreeNode(nodeId) {
                                form["frm:treeNodeParent"].value = nodeId;
                                document.getElementById("frm:addTreeNodeButton").onclick();
                            }
                            //-->
                        </script>


                        <!-- General fields -->
                        <table>
                            <!-- PREVIEW -->
                            <tr>
                                <td colspan="2">
                                    <ui:fragment rendered="#{srcEditor.content.previewAvailable}">
                                        <img src="thumbnail/pk#{srcEditor.id}.1/s2/ts#{fxSystemBean.currentTimeMillis}"
                                             alt="Preview" title="Preview" border="0" style="border:1px solid gray"/>
                                    </ui:fragment>
                                </td>
                            </tr>
                            <!-- ACL -->
                            <tr>
                                <ui:fragment rendered="#{not srcEditor.supportSecurity}">
                                    <td colspan="2"><i>#{fxMessageBean['Content.msg.noSecurity']}</i></td>
                                </ui:fragment>
                                <ui:fragment rendered="#{srcEditor.supportSecurity}">
                                    <td>
                                        #{fxMessageBean['Content.field.ACL']}
                                    </td>
                                    <td>
                                        <ui:fragment rendered="#{srcEditor.readOnly==false}">
                                            <t:selectOneListbox size="1" id="acl" value="#{srcEditor.acl}"
                                                                converter="SelectableConverter">
                                                <f:selectItems value="#{fxSelectBean.contentACLs}"/>
                                            </t:selectOneListbox>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{srcEditor.readOnly==true}">
                                            <span class="readonlyValue">#{srcEditor.acl.name}</span>
                                        </ui:fragment>
                                    </td>
                                </ui:fragment>
                            </tr>
                            <!-- Workflow step -->
                            <tr>
                                <td>
                                    #{fxMessageBean['Content.field.step']}
                                </td>
                                <td>
                                    <ui:fragment rendered="#{srcEditor.readOnly==false}">
                                        <t:selectOneListbox size="1" id="step" value="#{srcEditor.step}">
                                            <f:selectItems value="#{srcEditor.possibleWorkflowSteps}"/>
                                        </t:selectOneListbox>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{srcEditor.readOnly==true}">
                                        <span class="readonlyValue">#{srcEditor.stepDescription}</span>
                                    </ui:fragment>
                                </td>
                            </tr>
                            <!-- Tree nodes -->
                            <tr>
                                <td valign="top">
                                    #{fxMessageBean['Content.field.nodes']}
                                </td>
                                <td>
                                    <!-- Tree -->
                                    <adm:ceRenderTreeNodes srcEditor="#{srcEditor}"/>
                                </td>
                            </tr>
                            <tr>
                                <!-- Version info -->
                                <td valign="top">
                                    #{fxMessageBean['Content.field.info']}
                                </td>
                                <td nowrap="nowrap">
                                    <adm:ceVersionInfo versionInfo="#{srcEditor.versionInfo}"/>    
                                </td>
                            </tr>
                        </table>

                        <!-- binary support hack -->
                        <t:inputHidden value="#{srcEditor.editorActionName}"  id="editorActionName"/>
                        <t:inputHidden value="#{srcEditor.editorActionXpath}" id="editorActionXpath"/>

                        <!-- Properties and Groups -->
                        <t:inputHidden value="#{srcEditor.elements}" id="elements"/>
                        <div style="position:relative;left:-10px">
                            <div style="padding-top: 3px; padding-left: 8px; width: 30px; float: left;">
                                <adm:ceRenderFieldMenu group="#{srcEditor.content.rootGroup}" icon="group"
                                                       srcEditor="#{srcEditor}"/>
                            </div>
                            <br clear="both"/>
                            <adm:ceRenderFields data="#{srcEditor.content.rootGroup.children}" srcEditor="#{srcEditor}"/>
                        </div>
                    </a4j:outputPanel>

                <div style="clear:both;height:20px"><!-- __ --></div>

                <ui:fragment rendered="#{srcEditor.readOnly and srcEditor.editAble}">
                    <adm:commandButton labelKey="Content.button.edit" location="both"
                                      bean="#{srcEditor}"
                                      icon="edit" action="enableEdit" id="enableEditButton"/>
                    <ui:fragment rendered="#{srcEditor.deleteAble}">
                        <adm:commandButton labelKey="Content.button.delete" location="both"
                                           bean="#{srcEditor}" confirmKey="Content.confirm.delete"
                                           icon="delete" action="delete" id="deleteButtonRO"/>
                    </ui:fragment>
                    <ui:fragment rendered="#{srcEditor.versionDeleteAble}">
                        <adm:commandButton labelKey="Content.button.deleteVersion" location="both"
                                           bean="#{srcEditor}" confirmKey="Content.confirm.deleteVersion"
                                           icon="delete" action="deleteCurrentVersion" id="deleteVersionButtonRO"/>
                    </ui:fragment>
                </ui:fragment>
                <ui:fragment rendered="#{srcEditor.readOnly==false}">
                    <!--
                    <adm:commandButton label="Content.button.saveInSession" location="both"
                                      bean="#{srcEditor}"
                                      icon="saveInSession" action="saveInSession" id="storeButton"/>
                                      -->

                    <ui:fragment rendered="#{srcEditor.new}">
                        <adm:commandButton labelKey="Content.button.create" location="both"
                                          bean="#{srcEditor}"
                                          icon="new" action="save" id="createButton"/>
                    </ui:fragment>

                    <ui:fragment rendered="#{srcEditor.new==false}">
                        <adm:commandButton labelKey="Content.button.save" location="both"
                                          bean="#{srcEditor}"
                                          icon="save" action="save" id="saveButton"/>

                        <adm:commandButton labelKey="Content.button.saveInNewVersion" location="both"
                                          bean="#{srcEditor}"
                                          icon="newVersion" action="saveInNewVersion" id="saveInNewVersionButton"/>

                        <adm:commandButton labelKey="Content.button.refresh" location="both"
                                          bean="#{srcEditor}" confirmKey="Content.confirm.refresh"
                                          icon="reload" action="reload" id="reloadButton"/>

                        <ui:fragment rendered="#{srcEditor.deleteAble}">
                            <adm:commandButton labelKey="Content.button.delete" location="both"
                                          bean="#{srcEditor}" confirmKey="Content.confirm.delete"
                                          icon="delete" action="delete" id="deleteButton"/>
                        </ui:fragment>
                        <ui:fragment rendered="#{srcEditor.versionDeleteAble}">
                            <adm:commandButton labelKey="Content.button.deleteVersion" location="both"
                                          bean="#{srcEditor}" confirmKey="Content.confirm.deleteVersion"
                                          icon="delete" action="deleteCurrentVersion" id="deleteVersionButton"/>
                        </ui:fragment>
                    </ui:fragment>


                    <adm:commandButton labelKey="Content.button.compact" location="toolbar"
                                      bean="#{srcEditor}"
                                      icon="compact" action="compact" id="compactButton"/>

                    <adm:commandButton labelKey="Content.button.cancel" location="both"
                                      bean="#{srcEditor}" confirmKey="Content.confirm.abort"
                                      icon="cancel" action="cancel" id="cancelButton"/>
                </ui:fragment>
            </ui:fragment>
</ui:composition>


</html>
