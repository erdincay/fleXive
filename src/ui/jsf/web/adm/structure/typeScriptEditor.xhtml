<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:s="http://myfaces.apache.org/sandbox"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:adm="http://www.flexive.com/jsf/admin"
      xmlns:fx="http://www.flexive.com/jsf/core">
<body>

<ui:composition template="/adm/contentTemplate.xhtml">
<ui:define name="head">
    <t:stylesheet path="/adm/css/content.css"/>
    <t:stylesheet path="/adm/css/structureEditor.css"/>
    <script type="text/javascript">
        dojo.require("dojo.widget.FilteringTable");
    </script>
</ui:define>

<ui:define name="body">
    <h:form id="frm" enctype="multipart/form-data">
        <adm:tab label="#{fxMessageBean['TypeEditor.tab.typeEditor']}" active="false" id="tab1"
                 bean="#{typeEditorBean}" action="showTypeEditor"/>
        <adm:tab label="#{fxMessageBean['ScriptEditor.tab.scriptEditor']} [#{typeEditorBean.eventScriptCount}]" active="true" id="tab2"/>

        <fx:fieldSet legend="#{fxMessageBean['ScriptEditor.label.assignedScripts']}">

        <fx:formRow label="#{fxMessageBean['ScriptEditor.label.scriptEvent']}" id="scriptEvents" height="85">
            <h:selectOneListbox id="scriptEvents" value="#{typeEditorBean.scriptEventId}" size="#{typeEditorBean.eventScriptCount + 1}">
                <f:selectItems value="#{typeEditorBean.scriptEvents}" />
                <a4j:support event="onchange" reRender="scripts" />
            </h:selectOneListbox>
        </fx:formRow>

        <a4j:outputPanel id="scripts">
            <fx:formRow label="#{fxMessageBean['ScriptEditor.label.scripts']}" id="scripts">
                <table>
                <tbody>
                <ui:repeat var="scriptInfo" value="#{typeEditorBean.scripts}">
                    <tr><td>
                    <h:commandLink id="withdrawButtons_#{scriptInfo.id}" action="#{typeEditorBean.withdrawScript}">
                        <t:graphicImage url="/adm/images/commandButton/remove.png"  style="margin-left:5px;"
                        styleClass="pngSupport"/>
                        <f:setPropertyActionListener target="#{typeEditorBean.scriptToWithdraw}" value="#{scriptInfo.id}"/>
                    </h:commandLink>
                   
                        
                    <h:commandLink id="editScripts_#{scriptInfo.id}" action="#{scriptBean.editScript}"
                                   value="#{scriptInfo.name}" actionListener="#{scriptBean.structureListen}">
                        <f:param name="oid" value="#{scriptInfo.id}"/>
                    </h:commandLink>                    
                    </td></tr>
                </ui:repeat>
                </tbody>
                </table>
            </fx:formRow>
        </a4j:outputPanel>

        </fx:fieldSet>

        <br/>
        <br/>
        <br/>


        <fx:fieldSet legend="#{fxMessageBean['ScriptEditor.label.chooseScriptsToAssign']}">

        <fx:formRow label="#{fxMessageBean['ScriptEditor.label.scriptEvent']}" id="scriptTypes2" height="85">
            <h:selectOneListbox id="scriptTypes2" value="#{typeEditorBean.scriptEvent}" size="7">
                <f:selectItems value="#{fxSelectBean.scriptEvents}" />
                <a4j:support event="onchange" reRender="scripts2, scripts3" actionListener="#{typeEditorBean.clearSelectedScript}"/>
            </h:selectOneListbox>
        </fx:formRow>

        <br/>
        <br/>

        <a4j:outputPanel id="scripts2">
            <fx:formRow label="#{fxMessageBean['ScriptEditor.label.scripts']}" id="scripts2">
                <h:selectOneListbox id="scriptTypes3" value="#{typeEditorBean.selectedScriptId}" size="5">
                    <f:selectItems value="#{typeEditorBean.scriptsAsId}" />
                    <a4j:support event="onchange" reRender="scripts3" />
                </h:selectOneListbox>
            </fx:formRow>
        </a4j:outputPanel>

        <br/>
        <br/>
        <br/>
        <a4j:outputPanel id="scripts3">
            <fx:formRow label="#{fxMessageBean['ScriptEditor.label.scripts']}" id="scripts3">
                #{typeEditorBean.selectedScriptName}
                <h:selectOneListbox id="scriptTypes4" value="#{typeEditorBean.selectedEvent}" size="1">
                    <f:selectItems value="#{fxSelectBean.scriptEvents}" />
                </h:selectOneListbox>
                <h:commandButton id="addScript" action="#{typeEditorBean.addScript}" value="AddScript"/>
            </fx:formRow>
        </a4j:outputPanel>

        </fx:fieldSet>

        <br/>
        <br/>
        <br/>

        <fx:fieldSet legend="#{fxMessageBean['ScriptEditor.label.scriptsToAssign']}">

        <h:dataTable value="#{typeEditorBean.selectedScripts}" var="itm">
            <h:column>
                <f:facet name="header">
                    <h:outputText value="Script name"/>
                </f:facet>
                <h:outputText value="#{itm.name}"/>
            </h:column>
            <h:column>
                <f:facet name="header">
                    <h:outputText value="Type"/>
                </f:facet>
                <h:outputText value="#{itm.event.name}"/>
            </h:column>
        </h:dataTable>

        <br/>
        <br/>
        <h:commandButton id="assignScripts" action="#{typeEditorBean.assignScripts}" value="#{fxMessageBean['ScriptEditor.button.assignScripts']}"/>
            &nbsp;
        <h:commandButton id="clearTable" action="#{typeEditorBean.clearTable}" value="#{fxMessageBean['ScriptEditor.button.clearTable']}"/>

        </fx:fieldSet>

        <br/>
        <br/>

        <adm:toolbarPluginButtons/>
    </h:form>


    <script type="text/javascript">


    </script>

</ui:define>
</ui:composition>
</body>
</html>
