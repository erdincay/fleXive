<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:adm="http://www.flexive.com/jsf/admin"
      xmlns:fx="http://www.flexive.com/jsf/core">
<body>

<ui:composition template="/adm/contentTemplate.xhtml">
<ui:define name="head">
    <t:stylesheet path="/adm/css/content.css"/>
    <t:stylesheet path="/adm/css/structureEditor.css"/>
</ui:define>

<ui:define name="body">
    <h:form id="frm" enctype="multipart/form-data">
        <adm:tab label="#{fxMessageBean['TypeEditor.tab.typeEditor']}" active="false" id="tab1"
                 bean="#{typeEditorBean}" action="showTypeEditor"/>
        <ui:fragment rendered="#{not typeEditorBean.type.new}">
            <adm:tab label="#{fxMessageBean['ScriptEditor.tab.scriptEditor']} [#{typeEditorBean.scriptCount}]" active="true" id="tab2"/>
        </ui:fragment>
        <div class="scriptTable">
            <fx:fieldSet legend="#{fxMessageBean['ScriptEditor.label.assignedScripts']}">
                <a4j:outputPanel id="scripts">
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    <a4j:commandLink action="#{typeEditorBean.scriptWrapper.sortByScripts}" reRender="scripts" styleClass="sortArrow">
                                        #{fxMessageBean['ScriptEditor.label.name']}
                                        <ui:fragment rendered="#{typeEditorBean.scriptWrapper.sortStatusScriptInfo == 1}">
                                            <h:graphicImage value="/adm/images/commandButton/down.png"/>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{typeEditorBean.scriptWrapper.sortStatusScriptInfo == 2}">
                                            <h:graphicImage value="/adm/images/commandButton/up.png"/>
                                        </ui:fragment>
                                    </a4j:commandLink>
                                </th>
                                <th>
                                    <a4j:commandLink action="#{typeEditorBean.scriptWrapper.sortByEvents}" reRender="scripts" styleClass="sortArrow">
                                        #{fxMessageBean['ScriptEditor.label.event']}
                                        <ui:fragment rendered="#{typeEditorBean.scriptWrapper.sortStatusEvent == 1}">
                                            <h:graphicImage value="/adm/images/commandButton/down.png"/>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{typeEditorBean.scriptWrapper.sortStatusEvent == 2}">
                                            <h:graphicImage value="/adm/images/commandButton/up.png"/>
                                        </ui:fragment>
                                    </a4j:commandLink>
                                </th>
                                <th>#{fxMessageBean['ScriptEditor.label.active']}</th>
                                <th>#{fxMessageBean['ScriptEditor.label.derivedUsage']}</th>
                                <th>#{fxMessageBean['ScriptEditor.label.actions']}</th>
                            </tr>
                        </thead>
                        <tbody>
                        <c:forEach var="listEntry" items="#{typeEditorBean.scriptWrapper.scriptList}">
                            <tr>
                                <td>
                                    <h:commandLink id="editScript_#{listEntry.id}" action="#{scriptBean.editScript}"
                                           value="#{listEntry.scriptInfo.name}" actionListener="#{scriptBean.structureListen}">
                                    <f:param name="oid" value="#{listEntry.scriptInfo.id}"/>
                                    </h:commandLink>
                                </td>
                                <td style="padding-left:15px">
                                    <h:outputText value="#{listEntry.scriptEvent.name}"/>
                                </td>
                                <td style="padding-left:15px">
                                    <h:selectBooleanCheckbox id="active_#{listEntry.id}" value="#{listEntry.active}" disabled="#{listEntry.derived || not typeEditorBean.editMode || not fxSystemBean.isInRole['ScriptManagement']}"/>
                                </td>
                                <td style="padding-left:15px">
                                    <h:selectBooleanCheckbox id="derivedUsage_#{listEntry.id}" value="#{listEntry.derivedUsage}" disabled="#{listEntry.derived || not typeEditorBean.editMode || not fxSystemBean.isInRole['ScriptManagement']}"/>
                                </td>
                                <td style="padding-left:15px">
                                    <ui:fragment rendered="#{typeEditorBean.editMode and not listEntry.derived and fxSystemBean.isInRole['ScriptManagement']}">
                                            <a4j:commandButton id="removeScript_#{listEntry.id}" action="#{typeEditorBean.removeScript}" reRender="scripts, tab2"
                                                               image="/adm/images/commandButton/delete.png" onclick=" var disabled=!confirm('#{fxMessageBean['ScriptEditor.message.remove']}'); if (disabled) return false;">
                                                <f:setPropertyActionListener target="#{typeEditorBean.scriptListFiler}" value="#{listEntry.id}"/>
                                            </a4j:commandButton>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{listEntry.derived}">
                                            <a4j:commandLink id="gotoTypeButton_#{listEntry.id}"
                                                 onclick="var treeframe=parent.getNavFrameWnd(); treeframe.selectNode(#{listEntry.derivedFrom}, true);">
                                                <h:outputText value="#{fxMessageBean['ScriptEditor.label.derivedFrom']} #{typeEditorBean.typeNameForId[listEntry.derivedFrom]}"/>
                                            </a4j:commandLink>
                                    </ui:fragment>
                                </td>
                            </tr>
                            </c:forEach>
                            <ui:fragment rendered="#{typeEditorBean.editMode and fxSystemBean.isInRole['ScriptManagement']}">
                                <tr>
                                    <td>
                                        <h:selectOneListbox size="1" id="selectedScriptInfo" value="#{typeEditorBean.selectedScriptInfo}"
                                                converter="SelectableConverter" disabled="#{not typeEditorBean.editMode}">
                                            <f:selectItems value="#{fxSelectBean.typeScripts}"/>
                                            <a4j:support event="onchange" reRender="selectedScriptEvent" />
                                        </h:selectOneListbox>
                                    </td>
                                    <td style="padding-left:15px">
                                         <h:selectOneListbox size="1" id="selectedScriptEvent" value="#{typeEditorBean.selectedScriptEventId}"
                                                 disabled="#{not typeEditorBean.editMode}">
                                            <f:selectItems value="#{fxSelectBean.typeScriptEvents}"/>
                                        </h:selectOneListbox>
                                    </td>
                                    <td style="padding-left:15px">
                                        <h:selectBooleanCheckbox id="selectedActive" value="#{typeEditorBean.selectedActive}"/>
                                    </td>
                                    <td style="padding-left:15px">
                                        <h:selectBooleanCheckbox id="selectedDerivedUsage" value="#{typeEditorBean.selectedDerivedUsage}"/>
                                    </td>
                                    <td style="padding-left:15px">
                                        <a4j:commandButton id="addScript" action="#{typeEditorBean.addScript}" reRender="scripts, tab2"
                                                           image="/adm/images/commandButton/new.png">
                                        </a4j:commandButton>
                                    </td>
                                </tr>
                            </ui:fragment>
                        </tbody>
                        </table>
                </a4j:outputPanel>
            </fx:fieldSet>
        </div>
        <ui:fragment rendered="#{(not typeEditorBean.type.new) and (not typeEditorBean.editMode) and typeEditorBean.structureManager}">
                <adm:commandButton labelKey="TypeEditor.button.editMode" location="both"
                        icon="edit"  action="toggleEditMode"  bean="#{typeEditorBean}" id="editModeButton"/>
        </ui:fragment>

        <ui:fragment rendered="#{not typeEditorBean.type.new and typeEditorBean.editMode}">
                <adm:commandButton labelKey="TypeEditor.button.cancel" location="both" lockscreen="false"
                        icon="cancel" id="cancelButton"
                        onclick="parent.getNavFrameWnd().openNode(#{typeEditorBean.type.id}, true);return false;"/>
        </ui:fragment>

        <ui:fragment rendered="#{not typeEditorBean.type.new and typeEditorBean.structureManager and typeEditorBean.editMode}">
            <adm:commandButton labelKey="TypeEditor.button.save" location="both" 
                            icon="save"  action="saveChanges"  bean="#{typeEditorBean}" id="saveChangesButton">
            </adm:commandButton>
        </ui:fragment>

     </h:form>
</ui:define>
</ui:composition>
</body>
</html>
