<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:fx="http://www.flexive.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
        >

<ui:composition>
    <fx:wrappedContentProvider contentId="#{contentId}" editorId="#{editorId}"
        editMode="#{editMode}" pk="#{pk}" content="#{content}" formPrefix="#{formPrefix}"
        typeId="#{typeId}" type="#{type}" var="#{var}" valueFormatter="#{valueFormatter}"
        disableAcl="#{disableAcl}" disableWorkflow="#{disableWorkflow}" disableEdit="#{disableEdit}"
        disableDelete="#{disableDelete}" disableVersion="#{disableVersion}" disableCompact="#{disableCompact}"
        disableSave="#{disableSave}" disableCancel="#{disableCancel}" disableButtons="#{disableButtons}"
        disableAddAssignment="#{disableAddAssignment}" disableRemoveAssignment="#{disableRemoveAssignment}"
        disablePositionAssignment="#{disablePositionAssignment}" disableMessages="#{disableMessages}"
        reRender="#{reRender}" reset="#{reset}" askLockedMode="#{askLockedMode}"
        lockedContentOverride="#{lockedContentOverride}" cannotTakeOverPermLock="#{cannotTakeOverPermLock}"
        askCreateNewVersion="#{askCreateNewVersion}" lockStatus="#{lockStatus}" lockStatusTooltip="#{lockStatusTooltip}"
        contentLocked="#{contentLocked}" looseLock="#{looseLock}" permLock="#{permLock}" takeOver="#{takeOver}"
        userMayTakeover="#{userMayTakeover}" userMayUnlock="#{userMayUnlock}" userMayLooseLock="#{userMayLooseLock}"
        userMayPermLock="#{userMayPermLock}" disableReferenceEditor="#{disableReferenceEditor}"
        closePanelScript="#{closePanelScript}" showLockOwner="#{showLockOwner}"
        hiddenAssignments="#{hiddenAssignments}" hiddenProperties="#{hiddenProperties}">

        <c:if test="#{not _ceContent.guiSettings.disableMessages and __ceError}">
                <!-- error messages outside of container output panel
                if a tag error happens -->
                <h:messages id="#{_ceContent.editorId}_#{__ceBean.messagesId}"/>
        </c:if>

        <c:if test="false">
            <!--a code to cancel the last edit on leaving the page (by navigate away or closing tab / browser)-->
        <script type="text/javascript">

            window.onbeforeunload = function (e) {
                try {
                    cancelEdit("#{_ceContent.editorId}");
                } catch (e) {
                    alert (e);
                }
            };

        </script>

        <a4j:jsFunction name="cancelEdit" actionListener="#{__ceBean.callBack}">
            <a4j:actionparam name="editorID"  assignTo="#{__ceBean.editorId}"/>
        </a4j:jsFunction>

         </c:if>

        <c:set var="__ce_reRenderSuffix" value=""/>

        <c:if test="false">
            <!-- ##############################################  -->
            <!-- ###  !!!!!DO NOT MODIFY __ce_reRender !!!!!###  -->
            <!-- ##############################################  -->
            <!--!!! DO NOT MODIFY __ce_reRender if Boxed !!!-->
            <!--we need to reRender the "super-parent" (the one who opens the references) and the top most reference -->
        </c:if>

        <c:if test="#{not __ceError}">

        <c:if test="#{not empty _ceContent.guiSettings.reRender}">
            <c:set var="__ce_reRenderSuffix" value=",#{_ceContent.guiSettings.reRender}"/>
        </c:if>
            <c:if test="#{not __ceRenderedBoxed}">
                <c:set var="__ce_reRender" value="#{_ceContent.editorId}"/>
                <c:set var="__ce_reRenderMove" value="#{_ceContent.editorId}"/>
            </c:if>
            <c:if test="#{__ceRenderedBoxed}">
                <c:set var="__ce_reRenderMove" value="#{__ce_reRender},#{_ceContent.editorId}"/>
            </c:if>

            <c:if test="false">
                <!-- ##############################################  -->
                <!-- ###  !!!!!DO NOT MODIFY __ce_reRender!!!!! ###  -->
                <!-- ##############################################  -->
            </c:if>


           <c:set var="__ce_reRenderButton" value="#{__ce_reRender}#{__ce_reRenderSuffix}"/>

            <!--hidden input elements for saving state only needed once per content editor form-->
            <c:set var="__ceAlreadyRendered" value="#{_ceContent.guiSettings.formPrefix}__ceRendered"/>
            <c:if test="#{not __ceRenderedBoxed and not requestScope[__ceAlreadyRendered]}">
                <!-- preserve stored contents -->
                <t:saveState id="ssContentStorage" value="#{__ceBean.contentStorage}"/>
                <!-- store selected elements from popup menu -->
                <t:inputHidden value="#{__ceBean.childrenToAdd}" id="__ceElements"/>
                <!-- binary input hack -->
                <t:inputHidden value="#{__ceBean.storageKey}" id="__ceStorageKey"/>
                <t:inputHidden value="#{__ceBean.nextA4jAction}" id="__ceNextA4jAction"/>
                <t:inputHidden value="#{__ceBean.actionXpath}" id="__ceActionXpath"/>
                <t:inputHidden id="__foldedGroups_toggledGroups" value="#{__ceBean.toggledGroups}"/>
                <t:inputHidden id="__foldedGroups_allOpened" value="#{__ceBean.allOpened}"/>
                <t:inputHidden id="__affectedXPath" value="#{__ceBean.affectedXPath}"/>
                <h:commandButton action="#{__ceBean.resolveA4jAction}" id="__ceResolveA4jAction"
                                 style="display:none;">
                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                </h:commandButton>
             </c:if>

            <c:set var="__ceRenderedBoxed" value="true"/>

            <a4j:outputPanel id="#{_ceContent.editorId}" display="block"
                             styleClass="'fxContentEditor_base'">
                <a4j:status id="#{_ceContent.editorId}_status" forceId="true">
                    <f:facet name="start">
                        <div class="fxContentEditor_statusStart" title="#{fxMessageBean['ContentEditor.button.busy.title']}"/>
                    </f:facet>
                </a4j:status>

               <c:if test="#{not _ceContent.guiSettings.disableMessages}">
                    <!-- error messages inside the container output panel
                    so that they update after an ajax reRender-->
                    <h:messages id="#{_ceContent.editorId}_#{__ceBean.messagesId}"/>
                </c:if>

                <ui:insert name="insertTop">
                    <ui:fragment rendered="#{not empty _ceContent.guiSettings.lockStatus and not _ceContent.new}">
                        <ui:fragment rendered="#{_ceContent.guiSettings.permLock or (not empty _ceContent.guiSettings.lockOwner and _ceContent.guiSettings.lockOwner ne fxSystemBean.userTicket.loginName)}">
                            <h:outputText value="#{fxMessageBean['ContentEditor.field.lockAdmin']}: #{_ceContent.guiSettings.lockStatus}"
                                        title="#{_ceContent.guiSettings.lockStatusTooltip}"/>
                        </ui:fragment>
                        <ui:fragment rendered="#{_ceContent.guiSettings.contentLocked and _ceContent.guiSettings.showLockOwner and not empty _ceContent.guiSettings.lockOwner and _ceContent.guiSettings.lockOwner ne fxSystemBean.userTicket.loginName}">
                            <br />
                            <h:outputText value="#{fxMessageBean['ContentEditor.field.lockOwner']}: #{_ceContent.guiSettings.lockOwner}" />
                        </ui:fragment>
                        <br/><br/>
                    </ui:fragment>
                </ui:insert>

                <ui:insert name="contentSettings">
                    <a4j:outputPanel id="#{_ceContent.editorId}_settings">
                        <c:if test="#{not _ceContent.guiSettings.disableAcl}">
                             <!-- ACL -->
<!--
                            <ui:fragment rendered="#{not _ceContent.supportSecurity}">
                                <em>#{fxMessageBean['ContentEditor.msg.noSecurity']}</em>
                            </ui:fragment>
-->
                            <ui:fragment rendered="#{_ceContent.supportSecurity}">
                                <ui:fragment rendered="#{not _ceContent.multipleContentACLs}">
                                    <fx:formRow labelKey="ContentEditor.field.ACL" id="#{_ceContent.editorId}_acl">
                                         <h:selectOneListbox id="#{_ceContent.editorId}_acl" size="1" value="#{_ceContent.aclId}"
                                                            disabled="#{not _ceContent.guiSettings.editMode or not empty _ceContent.guiSettings.openedReferenceId}">
                                            <f:selectItems value="#{fxSelectBean.instanceACLs}"/>
                                        </h:selectOneListbox>
                                    </fx:formRow>
                                </ui:fragment>
                                <ui:fragment rendered="#{_ceContent.multipleContentACLs}">
                                    <fx:formRow labelKey="ContentEditor.field.ACL" id="#{_ceContent.editorId}_acls">
                                         <h:selectManyListbox id="#{_ceContent.editorId}_acls" size="4" value="#{_ceContent.aclIds}"
                                                            disabled="#{not _ceContent.guiSettings.editMode or not empty _ceContent.guiSettings.openedReferenceId}">
                                            <f:selectItems value="#{fxSelectBean.instanceACLs}"/>
                                        </h:selectManyListbox>
                                    </fx:formRow>
                                </ui:fragment>
                            </ui:fragment>
                        </c:if>
                        <c:if test="#{not _ceContent.guiSettings.disableWorkflow}">
                            <!-- wf step -->
                            <fx:formRow labelKey="ContentEditor.field.step" id="#{_ceContent.editorId}_step">
                                 <h:selectOneListbox id="#{_ceContent.editorId}_step" size="1" value="#{_ceContent.step}"
                                                     disabled="#{not _ceContent.guiSettings.editMode or not empty _ceContent.guiSettings.openedReferenceId}">
                                    <f:selectItems value="#{_ceContent.possibleWorkflowSteps}"/>
                                </h:selectOneListbox>
                            </fx:formRow>
                        </c:if>
                    </a4j:outputPanel>
                </ui:insert>

                <ui:insert name="insertMiddle"/>

                <!-- generated id of the content editor root element -->
                <!-- doesn't work with a4j:reRendered attribute unfortunately
                <c:set var="editor_root" value="#{__ceBean.contentStorage[_ceContent.editorId].idGenerator[__ceBean.contentStorage[_ceContent.editorId].content.rootGroup]}"/-->
                <c:set var="editor_root" value="#{_ceContent.editorId}_editor"/>
                <!-- Content editor screen -->
                <a4j:outputPanel id="#{editor_root}" styleClass="fxContentEditor_editorContent">
                    <ui:fragment rendered="#{_ceContent.content.rootGroup.hasGroups}">
                        <!-- open and fold groups -->
                        <div title="#{fxMessageBean['ContentEditor.button.openGroups.title']}"
                           class="fxContentEditor_openGroups"
                           onclick="flexive.contentEditor.toggleGroups('#{_ceContent.editorId}',true);"> </div>
                        <div title="#{fxMessageBean['ContentEditor.button.foldGroups.title']}"
                           class="fxContentEditor_foldGroups"
                           onclick="flexive.contentEditor.toggleGroups('#{_ceContent.editorId}',false);"> </div>
                    </ui:fragment>

                    <ui:fragment rendered="#{_ceContent.content.rootGroup.hasMultiLangProperty and _ceContent.guiSettings.editMode}">
                        <!-- input language switch -->
                        <div class="fxContentEditor_languageSwitch">
                            <div style="#{not _ceContent.guiSettings.editMode or not empty _ceContent.guiSettings.openedReferenceId ? 'display:none' : ''}">
                                <fx:formRow labelKey="ContentEditor.field.language" id="#{_ceContent.editorId}_updateLanguage">
                                    <fx:fxValueInputLanguageSelect id="#{_ceContent.editorId}_updateLanguage"/>
                                </fx:formRow>
                            </div>
                        </div>
                    </ui:fragment>

                    <!-- Properties and Groups -->
                    <!-- clear group ids from last request -->
                     <script type="text/javascript">
                        flexive.contentEditor.clearGroupIds("#{_ceContent.editorId}");
                    </script>
                    <div>
                        <div>
                            <fx:fxCeRenderFieldsMenu element="#{_ceContent.content.rootGroup}" icon="group"/>
                        </div>
                        <br clear="all"/>
                        <fx:fxCeRenderFields data="#{_ceContent.content.rootGroup.childrenWithoutInternal}"/>

                    </div>
                     <script type="text/javascript">
                            // apply folding
                            flexive.contentEditor.applyGroupFolding("#{_ceContent.guiSettings.formPrefix}","#{_ceContent.editorId}");
                            // highlight affected xpath
                            flexive.contentEditor.highlightAffectedXpath("#{_ceContent.guiSettings.formPrefix}","#{_ceContent.editorId}");
                    </script>
                </a4j:outputPanel>

                <div style="clear:both;height:20px"><!-- __ --></div>

                <a4j:outputPanel id="#{_ceContent.editorId}_buttons" rendered="#{(not _ceContent.guiSettings.disableButtons and empty _ceContent.guiSettings.openedReferenceId) or not _ceContent.guiSettings.editMode}" layout="block">
                <ui:insert name="buttons">
                    <!-- EDIT button -->
                    <ui:fragment rendered="#{not _ceContent.guiSettings.editMode and _ceContent.content.permissions.mayEdit and empty _ceContent.guiSettings.openedReferenceId}">
                        <ui:fragment rendered="#{not _ceContent.guiSettings.disableEdit and _ceContent.guiSettings.userMayUnlock}">
                            <ui:insert name="editButton">
                                <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.edit']}"
                                                   title="#{fxMessageBean['ContentEditor.button.edit.title']}"
                                                   action="#{__ceBean.enableEdit}" reRender="#{__ce_reRenderButton}"
                                                   status="#{_ceContent.editorId}_status">
                                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                </a4j:commandButton>
                            </ui:insert>
                        </ui:fragment>
                    </ui:fragment>
                    <!-- create button -->
                    <ui:fragment rendered="#{_ceContent.guiSettings.editMode}">
                        <ui:fragment rendered="#{_ceContent.new}">
                            <ui:fragment rendered="#{not _ceContent.guiSettings.disableSave
                                    and empty _ceContent.guiSettings.openedReferenceId and _ceContent.guiSettings.editMode}">
                                <ui:insert name="createButton">
                                    <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.create']}"
                                                       title="#{fxMessageBean['ContentEditor.button.create.title']}"
                                                       action="#{__ceBean.save}"
                                                       onclick="flexive.contentEditor.preSubmit();#{_ceContent.closePanelScript}"
                                                       reRender="#{__ce_reRenderButton}"
                                                       status="#{_ceContent.editorId}_status">
                                        <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                        <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                    </a4j:commandButton>
                                </ui:insert>
                            </ui:fragment>
                        </ui:fragment>
                        <!-- save button -->
                        <ui:fragment rendered="#{not _ceContent.new}">
                            <ui:fragment rendered="#{not _ceContent.guiSettings.disableSave
                                    and empty _ceContent.guiSettings.openedReferenceId and _ceContent.guiSettings.editMode}">
                                <ui:insert name="saveButton">
                                    <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.save']}"
                                                       title="#{fxMessageBean['ContentEditor.button.save']}"
                                                       action="#{__ceBean.save}"
                                                       onclick="flexive.contentEditor.preSubmit();"
                                                       reRender="#{__ce_reRenderButton}"
                                                       status="#{_ceContent.editorId}_status">
                                        <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                        <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                    </a4j:commandButton>
                                </ui:insert>
                            </ui:fragment>
                            <!-- save in new version button -->
                            <ui:fragment rendered="#{not _ceContent.guiSettings.disableVersion and not _ceContent.guiSettings.disableSave
                                    and empty _ceContent.guiSettings.openedReferenceId and _ceContent.guiSettings.editMode}">
                                <ui:insert name="saveInNewVersionButton">
                                    <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.saveInNewVersion']}"
                                                       title="#{fxMessageBean['ContentEditor.button.saveInNewVersion.title']}"
                                                       action="#{__ceBean.saveInNewVersion}"
                                                       onclick="flexive.contentEditor.preSubmit();#{_ceContent.closePanelScript}"
                                                       reRender="#{__ce_reRenderButton}"
                                                       status="#{_ceContent.editorId}_status">
                                        <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                        <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                    </a4j:commandButton>
                                </ui:insert>
                            </ui:fragment>
                            <!-- delete version button -->
                            <ui:fragment rendered="#{_ceContent.versionDeleteAble and
                                   not _ceContent.guiSettings.disableDelete and not _ceContent.guiSettings.disableVersion
                                   and empty _ceContent.guiSettings.openedReferenceId and _ceContent.guiSettings.editMode}">
                                <ui:insert name="deleteVersionButton">
                                    <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.deleteVersion']}"
                                                       title="#{fxMessageBean['ContentEditor.button.deleteVersion.title']}"
                                                       action="#{__ceBean.deleteCurrentVersion}"
                                                       onclick="flexive.contentEditor.preSubmit();"
                                                       reRender="#{__ce_reRenderButton}"
                                                       status="#{_ceContent.editorId}_status">
                                        <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                        <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                    </a4j:commandButton>
                                </ui:insert>
                            </ui:fragment>
                        </ui:fragment>
                        <!-- compact button -->
                        <ui:fragment rendered="#{not _ceContent.guiSettings.disableCompact
                                                         and empty _ceContent.guiSettings.openedReferenceId
                                                         and _ceContent.guiSettings.editMode}">
                            <ui:insert name="compactButton">
                                <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.compact']}"
                                                   title="#{fxMessageBean['ContentEditor.button.compact.title']}"
                                                   action="#{__ceBean.compact}" onclick="flexive.contentEditor.preSubmit();"
                                                   reRender="#{__ce_reRenderButton}"
                                                   status="#{_ceContent.editorId}_status">
                                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                </a4j:commandButton>
                            </ui:insert>
                        </ui:fragment>
                        <!-- sort button -->
                        <ui:fragment rendered="#{not _ceContent.guiSettings.disablePositionAssignment}">
                            <ui:insert name="sortButton">
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.sortProperties']}"
                                               title="#{fxMessageBean['ContentEditor.button.sortProperties.title']}"
                                               action="#{__ceBean.sortProperties}"
                                               onclick="flexive.contentEditor.preSubmit();"
                                               reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                            </ui:insert>
                        </ui:fragment>
                        <!-- save and cancel button -->
                        <ui:fragment
                                rendered="#{not _ceContent.new and not _ceContent.guiSettings.disableCancel and empty _ceContent.guiSettings.openedReferenceId and _ceContent.guiSettings.editMode}">
                            <ui:insert name="saveAndCancelButton">
                                <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.saveAndCancel']}"
                                                   action="#{__ceBean.saveAndCancel}"
                                                   onclick="flexive.contentEditor.preSubmit();#{_ceContent.closePanelScript}"
                                                   title="#{fxMessageBean['ContentEditor.button.saveAndCancel.title']}"
                                                   reRender="#{__ce_reRenderButton}" status="#{_ceContent.editorId}_status">
                                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                </a4j:commandButton>
                            </ui:insert>
                        </ui:fragment>
                        <!-- cancel button -->
                        <ui:fragment
                                rendered="#{not _ceContent.guiSettings.disableCancel and empty _ceContent.guiSettings.openedReferenceId and _ceContent.guiSettings.editMode}">
                            <ui:insert name="cancelButton">
                                <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.cancel']}"
                                                   action="#{__ceBean.preCancel}"
                                                   onclick="if (!flexive.contentEditor.preA4jAction('#{_ceContent.guiSettings.formPrefix}','#{_ceContent.editorId}','','preCancel')) return false; flexive.contentEditor.ignoreEvent(event);"
                                                   title="#{fxMessageBean['ContentEditor.button.cancel.title']}"
                                                   reRender="#{__ce_reRenderButton}" status="#{_ceContent.editorId}_status">
                                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                </a4j:commandButton>
                            </ui:insert>
                        </ui:fragment>
                    </ui:fragment>
                    <!-- delete button -->
                    <ui:fragment rendered="#{not _ceContent.new and _ceContent.content.permissions.mayDelete
                                and not _ceContent.guiSettings.disableDelete and empty _ceContent.guiSettings.openedReferenceId}">
                        <ui:insert name="deleteButton">
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.delete']}"
                                               title="#{fxMessageBean['ContentEditor.button.delete.title']}"
                                               action="#{__ceBean.delete}"
                                               onclick="flexive.contentEditor.preSubmit();#{_ceContent.closePanelScript}"
                                               reRender="#{__ce_reRenderButton}" status="#{_ceContent.editorId}_status">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                        </ui:insert>
                    </ui:fragment>
                    <!-- take over lock button -->
                    <ui:fragment
                            rendered="#{_ceContent.guiSettings.userMayTakeover and not _ceContent.new and _ceContent.content.permissions.mayEdit}">
                        <ui:insert name="takeoverButton">
                            <a4j:commandButton id="#{editorId}_overrideButton"
                                               value="#{fxMessageBean['ContentEditor.button.lockOverride']}"
                                               title="#{fxMessageBean['ContentEditor.button.lockOverride.title']}"
                                               action="#{__ceBean.lockOverride}" reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                        </ui:insert>
                    </ui:fragment>
                    <!-- loose lock button -->
                    <ui:fragment
                            rendered="#{not _ceContent.guiSettings.looseLock and not _ceContent.new and _ceContent.guiSettings.userMayLooseLock and _ceContent.content.permissions.mayEdit}">
                        <ui:insert name="looseLockButton">
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.acquireLooseLock']}"
                                               title="#{fxMessageBean['ContentEditor.button.acquirePermLock.title']}"
                                               action="#{__ceBean.acquireLooseLock}" reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status"
                                               onclick="flexive.contentEditor.preSubmit();">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                        </ui:insert>
                    </ui:fragment>
                    <!-- permanent lock button -->
                    <ui:fragment
                            rendered="#{not _ceContent.guiSettings.permLock and not _ceContent.new and _ceContent.guiSettings.userMayPermLock and _ceContent.content.permissions.mayEdit}">
                        <ui:insert name="permLockButton">
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.acquirePermLock']}"
                                               title="#{fxMessageBean['ContentEditor.button.acquirePermLock.title']}"
                                               action="#{__ceBean.acquirePermLock}" reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status"
                                               onclick="flexive.contentEditor.preSubmit();">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                        </ui:insert>
                    </ui:fragment>
                    <!-- unlock button -->
                    <ui:fragment rendered="#{_ceContent.guiSettings.contentLocked and not _ceContent.guiSettings.editMode and _ceContent.guiSettings.userMayUnlock and _ceContent.content.permissions.mayEdit}">
                        <ui:insert name="unlockButton">
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.unlock']}"
                                               title="#{fxMessageBean['ContentEditor.button.unlock.title']}"
                                               action="#{__ceBean.unLock}" reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status"
                                               onclick="flexive.contentEditor.preSubmit();">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                        </ui:insert>
                    </ui:fragment>
                    <!-- extend lock features -->
                    <ui:fragment rendered="#{_ceContent.guiSettings.contentLocked and _ceContent.content.permissions.mayEdit}">
                        <ui:fragment rendered="#{_ceContent.guiSettings.looseLock or _ceContent.guiSettings.permLock and not _ceContent.new}">
                            <!-- show  remaining lock time -->
                            <ui:insert name="lockTimeButton">
                                <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.remainingTime']}"
                                                   title="#{fxMessageBean['ContentEditor.button.remainingTime.title']}"
                                                   action="#{__ceBean.computeRemainingLockTime}"
                                                   status="#{_ceContent.editorId}_status"
                                                   reRender="#{__ce_reRenderButton}"
                                                   onclick="flexive.contentEditor.preSubmit();">
                                    <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                    <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                </a4j:commandButton>
                            </ui:insert>
                            <!-- extend lock -->
                            <ui:fragment rendered="#{_ceContent.guiSettings.userMayUnlock}">
                                <ui:insert name="extendLockTimeButton">
                                    <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.extendLock']}"
                                                       title="#{fxMessageBean['ContentEditor.button.extendLock.title']}"
                                                       action="#{__ceBean.extendLock}"
                                                       status="#{_ceContent.editorId}_status"
                                                       reRender="#{__ce_reRenderButton}"
                                                       onclick="flexive.contentEditor.preSubmit();">
                                        <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                        <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                                    </a4j:commandButton>
                                </ui:insert>
                            </ui:fragment>

                        </ui:fragment>
                    </ui:fragment>

                <ui:insert name="additionalButtons"/>
                    </ui:insert>
                </a4j:outputPanel>
                <!-- lock options before editmode is / can be entered -->
                <ui:fragment rendered="#{not _ceContent.guiSettings.editMode and _ceContent.content.permissions.mayEdit
                                                                    and empty _ceContent.guiSettings.openedReferenceId}">

                    <!-- take over loose lock? -->
                    <ui:fragment rendered="#{_ceContent.guiSettings.askLockedMode}">
                        <ui:insert name="editLockedContentButtons">
                            <br/><br/>
                            <c:if test="#{_ceContent.guiSettings.looseLock}">
                                <h:outputText escape="false" value=" #{fxMessageBean['ContentEditor.msg.looseLock.takeover']} "/>
                            </c:if>
                            <c:if test="#{_ceContent.guiSettings.permLock}">
                                <h:outputText escape="false" value=" #{fxMessageBean['ContentEditor.msg.permLock.takeover']} "/>
                            </c:if>
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.lockOverrideYes']}"
                                               title="#{fxMessageBean['ContentEditor.button.lockOverrideYes.title']}"
                                               action="#{__ceBean.lockOverrideAndEdit}" reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.lockOverrideNo']}"
                                               title="#{fxMessageBean['ContentEditor.button.lockOverrideNo.title']}"
                                               action="#{__ceBean.noLockOverride}" reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                        </ui:insert>
                    </ui:fragment>
                    <!-- new version? -->
                    <ui:fragment rendered="#{_ceContent.guiSettings.askCreateNewVersion}">
                        <ui:insert name="editLockedContentNewVersionButtons">
                            <br/><br/>
                            <h:outputText value=" #{fxMessageBean['ContentEditor.msg.askCreateNewVersion']} "/>
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.askCreateNewVersionYes']}"
                                               title="#{fxMessageBean['ContentEditor.button.askCreateNewVersionYes.title']}"
                                               action="#{__ceBean.enableEditInNewVersion}"
                                               reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                            <a4j:commandButton value="#{fxMessageBean['ContentEditor.button.askCreateNewVersionNo']}"
                                               title="#{fxMessageBean['ContentEditor.button.askCreateNewVersionNo.title']}"
                                               action="#{__ceBean.cancel}" reRender="#{__ce_reRenderButton}"
                                               status="#{_ceContent.editorId}_status">
                                <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                                <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                            </a4j:commandButton>
                        </ui:insert>
                    </ui:fragment>
                </ui:fragment>
                <!-- remaining lock time panel -->
                <ui:fragment rendered="#{_ceContent.guiSettings.contentLocked}">
                    <ui:insert name="lockTimePanel">
                        <a4j:outputPanel id="#{_ceContent.editorId}_remainingTime" rendered="#{not empty __ceBean.remainingLockTime}" layout="block">
                            <br/><br/>
                            <c:if test="#{_ceContent.guiSettings.permLock}">
                                <h:outputText escape="false" value="#{fxMessageBean['ContentEditor.msg.permLockTimeRemaining']}"/>
                            </c:if>
                            <c:if test="#{_ceContent.guiSettings.looseLock}">
                                <h:outputText escape="false" value="#{fxMessageBean['ContentEditor.msg.looseLockTimeRemaining']}"/>
                            </c:if>
                            <h:outputText value=" #{__ceBean.remainingLockTime}"/>
                        </a4j:outputPanel>
                    </ui:insert>
                </ui:fragment>
                <ui:insert name="insertBottom"/>

                <c:if test="#{__ceBean.changed}">
                    <script language="JavaScript" type="text/javascript">
                        try {
                            flexive.yui.require("container");
                            flexive.yui.onYahooLoaded(function() {
                                try {
                                    flexive.yui.dialogs.showConfirmDialog(
                                            "#{fxMessageBean['Content.confirm.abort']}",        /*message*/
                                            "#{fxMessageBean['Global.dialog.confirm.title']}",  /*title*/
                                            "#{fxMessageBean['Global.dialog.confirm.yes']}",    /*yesButton*/
                                            "#{fxMessageBean['Global.dialog.confirm.no']}",     /*noButton*/
                                            function() {                                        /*on confirmed*/
                                                eval(document.getElementById("#{formPrefix}:#{editorId}_CallbackIcon").onclick());
                                            },
                                            function() {}                                       /*on cancel*/               
                                            );
                                } catch(err) {
                                    alert(err);
                                }
                            });
                        } catch(err) {
                            alert(err);
                        }
                    </script>
                    <div id="#{editorId}_CallbackDiv" style="display:none;">
                        <a4j:commandButton id="#{editorId}_CallbackIcon" location="content"
                                           onclick="flexive.contentEditor.preSubmit();"
                                           action="#{__ceBean.callBack}" icon="cancel" reRender="#{__ce_reRenderButton}">
                            <f:setPropertyActionListener value="#{_ceContent.editorId}" target="#{__ceBean.editorId}"/>
                            <f:setPropertyActionListener value="#{__ce_reRender}" target="#{__ceBean.reRender}"/>
                        </a4j:commandButton>
                    </div>
                </c:if>

            <fx:yuiSetup/>
            </a4j:outputPanel>
        </c:if>
    </fx:wrappedContentProvider>
</ui:composition>

</html>
